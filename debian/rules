#!/usr/bin/make -f

PACKAGE = libpciaccess0

CFLAGS = -Wall -g
ifneq (,$(filter noopt,$(DEB_BUILD_OPTIONS)))
	CFLAGS += -O0
else
	CFLAGS += -O2
endif
ifneq (,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
	NUMJOBS = $(patsubst parallel=%,%,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
	MAKEFLAGS += -j$(NUMJOBS)
endif

%:
	dh $@ --with autoreconf --builddirectory=build/

override_dh_auto_configure:
	dh_auto_configure -- \
		--with-pciids-path=\$${prefix}/share/misc \
		--with-zlib \
		CFLAGS="$(CFLAGS)"

override_dh_install:
	find debian/tmp -type f -name *.la -delete
	dh_install --fail-missing

override_dh_makeshlibs:
	dh_makeshlibs -V'libpciaccess0 (>= 0.11.0)' --add-udeb=$(PACKAGE)-udeb -- -c4
